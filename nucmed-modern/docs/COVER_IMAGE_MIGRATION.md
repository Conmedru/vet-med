# Cover Image Storage & Migration

## Текущее состояние (Base64)

По запросу, временно реализовано хранение обложек в формате **Base64 Data URLs** прямо в базе данных. Это позволяет показывать демо клиенту без настройки внешнего S3 хранилища.

### Особенности Base64 решения:
- ✅ Не требует внешней инфраструктуры
- ⚠️ Увеличивает размер базы данных
- ⚠️ Может замедлять загрузку списков статей

## Планируемая миграция на S3

В будущем, для продакшена, необходимо перенести изображения в S3 (Yandex Object Storage).

### 1. Настройка S3

1. **Создать бакет в Yandex Cloud**
   - Object Storage → Создать бакет
   - Имя: `nuclear-news-images`
   - Публичный доступ: **Чтение**

2. **Получить ключи доступа**
   - IAM → Сервисные аккаунты → Создать (роль `storage.editor`)
   - Создать статический ключ доступа

3. **Обновить .env**

```bash
S3_ENDPOINT="https://storage.yandexcloud.net"
S3_BUCKET="nuclear-news-images"
S3_ACCESS_KEY="ваш-access-key"
S3_SECRET_KEY="ваш-secret-key"
```

### 2. Запуск миграции

После настройки `.env`, просто запустите тот же скрипт миграции. Он автоматически обнаружит S3 конфигурацию и начнет загружать туда изображения.

**Важно:** Скрипт нужно будет доработать для миграции **Base64 -> S3** (сейчас он умеет только Replicate -> S3).

## Технические детали реализации

### Генерация обложек
`app/api/articles/[id]/generate-cover/route.ts`
- Если S3 настроен: загружает в S3, сохраняет URL.
- Если S3 **НЕ** настроен: конвертирует в Base64, сохраняет Data URL.

### Скрипты
- `scripts/migrate-cover-images.ts`: Основной скрипт миграции.
- `scripts/check-replicate-urls.ts`: Проверка наличия временных ссылок Replicate.

